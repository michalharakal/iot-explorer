<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<meta name="author" content="Michal Harakal">
<title>Responsive Multiplatform HMI-Anwendungen mit Kotlin Multiplatform und Jetpack Compose</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Responsive Multiplatform HMI-Anwendungen mit Kotlin Multiplatform und Jetpack Compose</h1>
<div class="details">
<span id="author" class="author">Michal Harakal</span><br>
<span id="email" class="email">harakal &lt;<a href="mailto:michal@harakal.de">michal@harakal.de</a></span><br>
<span id="revdate">Alexander von Below &lt;alex@vonbelow.com&gt;</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>3.0, July 29, 2022:</p>
</div>
<div class="paragraph">
<p>Michal Harakal, Alexander von Below</p>
</div>
<div class="paragraph">
<p>Mit fortgeschrittener Digitalisierung wachsen Anforderungen auch auf die HMI (Human machine interface)-Anwendungen in verschiedenen industriellen Bereichen.
Nicht nur sicher, zuverlässig und schlank, aber auch modern, gut aussehend und vernetzt sollten sie werden.
Mit einer einfachen Desktop-App, die mehrere Protokolle beherrscht, schauen wir uns in diesem Artikel die Stärken von Kotlin und Kotlin Multiplatform, wie man einfach mehrere Plattformen Desktop und Mobil (besonders mit Fokus auf Betriebssysteme von Apple) ohne Kompromissen unterstützen kann, wie wunderbar die Interoperabilität zwischen Kotlin und JVM funktioniert und wie deklarative UI Frameworks, wie Jetpack Compose und Swift UI, die Art und Weise verändern, wie man reaktive Bedienoberfläche heutzutage entwickelt.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_iot_explorer_app">IoT Explorer App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Um die Konzepte und Ideen für eine moderne Bedienoberfläche zu validieren, implementieren wir als ein Konzept eine App, die man zum Betrachten und verändern von Werten angebundener Geräte nutzen kann. Die Kommunikation mit den Geräten wird über maschinenorientierte Protokolle realisiert. Die Geräte können Maschinen, industrielle Anlagen oder Endverbrauchergeräte sein. Der Kommunikation bringt mehrere Herausforderungen und wir schauen uns die Möglichkeiten genauer an, die uns erlauben Bibliotheken, die für das jeweilige Protokoll am besten geeignet sind in die unsere App zu integrieren.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/iot-explorer.png" alt="iot explorer">
</div>
<div class="title">Figure 1. &lt;Bild 1&gt; Hauptbildschirm</div>
</div>
<div class="paragraph">
<p>Das &lt;Bild 1&gt; zeigt eine erste Iteration von dem Hauptbildschirm der IoT Explorer UI App. In dem linken Teil, in einer Baumansicht  sind Geräte nach Protokollen gruppiert. Die dazugehörigen Werte und zugehörige Möglichkeiten sie zu verändern, sind als eine Liste in rechten Teil des Fensters dargestellt. Wichtig ist, dass die Werte im Gerät selber, bei der Übertragung und wenn sie in der App angezeigt werden unterschiedliche Representation haben können. Genauso wichtig sind die physikalischen Einheiten und die Formatierung, es könnte sogar möglich sein, dass in den unterschiedlichen Teilen der App der gleiche Wert eine unterschiedliche Darstellung haben kann (zum Beispiel als 0 und 1 oder grafische Darstellung als ein Schalter).</p>
</div>
<div class="paragraph">
<p>Wenn wir über der Implementierung der App weiter nachdenken sollten wir auch berücksichtigen, wie schnell sich manche Werte verändern, ob sie beim Gerät angefragt werden muss, oder eine Wertveränderung automatisch übermittelt wird.
Ein weiters Spezifikum der App ist der Datenfluß: Die App is Daten getrieben, der Update von Werten muss automatisch stattfinden und soll einfach zu implementieren sein.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_iot">IoT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Das Internet of Things (IoT) ist ein sehr breiter Begriff und beinhaltet nicht nur unterschiedliche Gerätetypen und Fähigkeiten, über die sie verfügen, sondern auch eine große Menge von Protokollen, die sie sprechen. IoT Explorer App benötigt nur eine kleine Untermenge dieser Merkmale, damit ist die Vielfälligkeit mit relativ einfachen Abstraktionen zu lösen. Die Geräte sind in Bäumen organisiert und deren Eigenschaften wie Werte oder Einstellungen sind als Knoten untergeordnet. Manche Protokolle wie z.B. KNX unterstützen einen Discovery Mechanismus, der ermöglicht die Geräte im Netzwerk zu entdecken. Bei anderen müssen die Geräte selber manuelle angebunden werden.</p>
</div>
<div class="paragraph">
<p>Eine Abstraktion können wir analog zu ein Betriebssystem als Treiber definieren.</p>
</div>
<div class="sect2">
<h3 id="_integration_in_kotlin_multiplatform">Integration in Kotlin Multiplatform</h3>
<div class="paragraph">
<p>In Kotlin Multiplatform lassen sich Gerätetreiber einschliesslich eines Communications Protocols einfach und schön implementieren. Weil Kotlin und gerade Kotlin Multiplatform noch seinen Weg in die größere Entwickler Community sucht, gibt es davon leider nocht nicht so viele. Hier zeigt aber Kotlin wiederum seine Stärken, zum Beispiel die sehr gute Interoperabilität mit der JVM, so dass man auf bestehende JVM Bibliotheken zugreifen kannm und mit Kotlin Native eine Möglichkeit eine native Implementierung des Protokolls in ein Kotlin Geräte Treiber einzubinden, was gerade für iOS sehr interessant ist.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_geteilte_freude_ist_doppelte_freude">Geteilte Freude ist doppelte Freude</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eines der Ziele, die wir uns für die App gesetzt haben war, dass die App auf unterschiedlichen Betriebssystemen und Endgeräten laufen soll. Eine separate App für jede Platform ist einerseits aufwendig, und das aus vielen Gründen (Entwickler:innen mit entsprechenden Fähigkeiten, Kosten, Zeit oder Wartbarkeit etc). Auf der anderen Seite steht die native Leistung oder die Art wie sich die App in ihren jeweiligen Ökosystemen anfühlt oder integrieren lässt. Die Suche nach dem perfekten Weg ist schon alt. Für Mobile Apps liegt der Anfang vermulich bei HTML-basierten Web-Apps (Cordova, Ionic), mit schwergewichtigen Cross Platform Frameworks wie Xamarin, bis zu hybriden Ansätzen wie React Native, Vue Native oder Flutter. Alle haben ihre Vor und Nachteile.  Als eine ernstzunehmende Alternative zeichnet sich Codesharing mit Kotlin in Multiplatform-Projekten ab, wo in Kotlin geschriebener Code auf unterschiedlichen Plattformen laufen kann.
Das Thema ist nicht neu und wurde schon öfter behandelt (Beispielsweise in Java Aktuell 01/2020). Mit der Zeit haben sich die Vorteile für Code Sharing mit Kotlin nicht nur bestätigt, sondern es sind auch mit weitere neue dazu gekommen, wie zum Beispiel Jetpack Compose.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kotlin_und_kotlin_mutliplatform">Kotlin und Kotlin Mutliplatform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Warum überhaupt Kotlin? Code sharing ist nichts Neues und funktioniert auch mit anderen Programmiersprachen.
Zunächst ist es Kotlin als Sprache selbst: Kotlin bezeichnet sich als kompakt und präzise, sicher, ausdrucksvoll, vollständig kompatibel und multiplatform fähig &lt;LINK 4&gt;. Schon aleine die ersten Eigenschaften machen Kotlin gerade für Java Entwickler:innen interessant. Und für unsere IoT App spielt gerade die Multiplatorffähigkeit eine beduetende Rolle. Ein wichtiger Teil der Kotlin multiplatformfähig macht, sind in die Sprache selber integrierte Schlüsselwort <strong>expected/actual</strong>, die ein fester Bestandteil der Programmiersprache sind.</p>
</div>
<div class="paragraph">
<p>Ein weiterer wichtiger Baustein, der das Bauen von reaktiven Apps vereinfacht und zur Sprache selber gehört, sind coroutines und Flows. Generell läuft die Kommunikation mit den Geräten im Hintergrund, dazu kommt dass wir mit mehrere Geräten gleichzeitig Daten austauschen wollen. Das wird durch Einsatz asynchroner Programmierung gelöst, bei der die einzelnen Abfragen nicht mehr hintereinander, sondern parallel ausgeführt werden. Das Aktualisieren der Bedienoberfläche findet nur in einem (anderen) Thread statt. Solcher Code ist normalerweise nicht einfach zu schreiben, und wenn dann auch noch Bildschirmrotation hinzukommt, die eine neue Anzeige des Objekts erfordert (bekannt als Activity Lifecycle) sind die schlaflosse Nächste beim Debuggen vorprogrammiert.</p>
</div>
<div class="paragraph">
<p>Kotlin löst das Problem mit dem Schlüsselwort <strong>suspend</strong> und führt ein Programmierparadigma benannt als <strong>Strukturierte Parallelität</strong> (structured concurency) ein. Die Hauptidee ist das Kapseln der Ausführung von parallelen Ausführungen in eigenen Blöcken, so dass der zuständige Code zusammen mit einem klaren Anfang und Ende geschrieben ist. Dies erzeugt nicht nur bessere Lesbarkeit und Fehlerbehandlung, sondern auch besseren Resource Management mit Resourcen wie zum Beispiel Threads.</p>
</div>
<div class="paragraph">
<p>Eine vollständige kompatibilität zum JVM war und bleibt eins der Hauptmerkmale vom Kotlin und erlaubt uns auch beim Thema Kotlin Multiplatform die Integration von JVM Bibliotheken. Gerade in Bereich maschinenorientierter Protokolle ist die Auswahl von qualitativ hochwertigen Bibliotheken sehr gut. Als Beispiele sind die Bibliotheken für die Kommunikation in KNX oder das Apache Projekt PLC4X mit mehreren SPS Protokollen im Portfolio(siehe Projekt Homepage &lt;LINK 5&gt;</p>
</div>
<div class="paragraph">
<p>Kotlin hat noch ein weiteres Ass im Ärmel: Kotlin/Native. Kotlin/Native is eine Technologie, die das Kompilieren vom Kotlin Code in den nativen binären Code erlaubt, der ohne eine virtuelle Maschine laufen kann. Kotlin/Native beinhalted ein LLVM basiertes Backend für den Kotlin Kompiler und eine native Implementierung der Kotlin Standard Bibliothek. Das ist genau der Weg, wie wir die nativen iOS und macOS Apps in Kotlin bauen können.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_softwarearchitektur">Softwarearchitektur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Die Softwarearchitektur einer App trägt maßgeblich dazu, wie viel von dem in Kotlin geschriebenen Code wiederverwendet kann. Beim Entwurf einer Softwarearchitektur für ein Kotlin-Multiplatform-Projekt steht neben den üblichen nichtfunktionalen Anforderungen wie Lesbarkeit oder Wartbarkeit auch der hohe Grad an Wiederverwendbarkeit von Code im Vordergrund. Eine einmal programmierte Lösung spart nicht nur Aufwand nach dem DRY-Prinzip („Don’t Repeat Yourself“), sondern kann so auch eine höhere Qualität und fachliche Korrektheit durch mehrfaches Anwenden erreichen. Für die IoT Explorer App haben wir uns an eine stark an „Clean Architecture"&lt;LINK 6&gt; angelehnt und Ergebniss ist auf dem &lt;BILD 3&gt;. Die Tatsache, dass aus Sicht der Clean Architecture die UI Android Frameworks nur am Rande stehen und der Fokus auf Entities und Use Cases in der Domain liegt, macht es einfach, eine Umsetzung unabhängig von der Plattform zu gestalten.</p>
</div>
<div class="sect2">
<h3 id="_kotlin_multiplatform">Kotlin multiplatform</h3>
<div class="imageblock">
<div class="content">
<img src="images/KMP_Architecture.png" alt="KMP Architecture">
</div>
<div class="title">Figure 2. &lt;BILD 3&gt;</div>
</div>
<div class="paragraph">
<p>Das Herzstück ist die CommonLib, die den Teil des Kodes beinhaltet, den man auf unterschiedlichen Platformen benutzt werden kann. Zusätzlich beinhaltet sie die tatsächliche Implementierung für native Code Teile, die nicht mit Kotlin umgesetzt werden können. Es steht auf soliden Grundlagen der Standard Bibliothek mit den Implementirugen für „kotlinx“-Serialisierung. Koroutinen werden zusätzlich zur Kotlin Standard Library mit FLow benutzt und in Abbildung 1 als ein wichtiger Baustein dargestellt.
Durch eine weitere Trennung der Implementierung, die sich um die Netzwerkkommunikation kümmert, und den Code, der für das Caching und die lokale Datenspeicherung zuständig ist, erzeugen wir zwar einen kleinen Mehraufwand (zum Beispiel bei den notwendigen ModelMappers), erreichen dafür allerdings die Freiheit, unterschiedliche Datenklassen für Netzwerk und Speicher zu nutzen. Dies wiederum ermöglicht eine Austauschbarkeit von Kommunikationsmodulen für unterschiedliche Protokolle mit unterschiedlichen Datentransfer-Objekten und Endpunkten.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle">Gradle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle ist weiterer Baustein, der die IoT Explorer App in dieser Form möglicht macht und spielt in diesem Projekt seine Stärken aus. Die erste Stärke ist die Möglichkeit, die Baukette mit eigenen Plugins zu erweitern. An dieser Stelle kommt die Kotlin Compiler Plugin Extension für Jetpack Compose zum Einsatz.
Eine weitere Stärke vom Gradle sind die Gradle Module. Mit Modulen erreichen wir eine physische Trennung zwischen Schichten in der Software Architektur, sodass man gezwungen ist sich an den Kontrakt der Schicht zu halten und nicht auf die Idee kommt, zum Beispiel im Code für das UI schnell mal eine Backendabfrage abzufeuern. Durch Gradle Module ist das auch das Teilen vom gemeinsamen Code für die jeweiligen Platformen möglich.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/modules.png" alt="modules">
</div>
<div class="title">Figure 3. &lt;BILD 2&gt; Gradle module</div>
</div>
<div class="paragraph">
<p>Auf dem &lt;BILD 2&gt; sind die Kotlin Multiplatform Module farbig hervorgehoben. Mit Linien sind die Abhängigkeiten zwischen dann einzelnen Modulen dargestellt.</p>
</div>
<div class="paragraph">
<p>Inzwischen unterstützt Gradle auch Kotlin als eine Skriptsprache, so es möglich ist die Konfigurationsskripte direkt in Kotlin zu schreiben, was gerade in den Entwicklungsumgebungen, die Kotlin unterstützen einen Vorteil ist. Und seit dem Android Plugin in der Version 4.0 unterstützt auch Google Kotlin als die Skriptsprache, für Gradle und es ist sogar der empfohlene Weg.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bedienoberflächen_mit_jetpack_compose">Bedienoberflächen mit Jetpack Compose</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Jetpack compose</strong> &lt;LINK 2&gt; ist ein Bestandteil der von Google als <strong>Jetpack</strong> &lt;LINK 1&gt; bezeichneten Bibliotheken, die helfen sollen, Best Practices zu befolgen und Boilerplate-Code zu reduzieren.
Dies ist eigentlich eine nüchterne Beschreibung von Google, in Wirklichkeit ist Jetpack Compose ein vollständiger Paradigmenwechsel, wie Bedienoberflächen programmiert werden, weg vom Imperativen Ansatz über XML zu einem mit Kotlin geschriebenen deklarativen Code, mit allen Vorteilen, die ein Einsatz einer vollwertigen Programmiersprache bietet.</p>
</div>
<div class="paragraph">
<p>Um zu verstehen, warum Jetpack Compose die passende Lösung für unsere IoT Explorer App ist, wir schauen zuerst das Code-Listing 2.</p>
</div>
<div class="listingblock">
<div class="title">Jetpack Compose DevicesTreeView</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">@Composable
fun DevicesTreeView(viewModel: DevicesTreeViewModel) = Surface {
    val viewState by viewModel.state.collectAsState()
    Box {
        if (viewState.items.isNotEmpty()) {
            LazyColumn {
                items(viewState.items.size) {
                    DeviceTreeItemView(viewState.items[it])
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Das Erste, was unsere Aufmerksamkeit wecken sollte, ist die erste Zeile mit der Annotation <em>Composable</em>.
Composable Funktionen sind die Grundbausteine zum Definieren der Bedienoberfläche.
Die Markierung einer Funktion (oder einer Lambdafunktion) als Composable weist darauf hin, dass die Funktion/Lambda ein Teil der Composition ist und beschreibt eine Transformation der Daten in eine Baumdatenstruktur.
Diese ist durch das UI Framework zum Rendern der Bedienoberfläche benutzt.
Als weiteres können wir die kompakte Form bemerken, die durch Einsatz von Lambda Funktionen und der Unterstützung von Kotlin für Type Builders (die gerne zum Definieren eigenen DSL Sprache benutzt werden) ermöglicht wird.
Wichtig ist auch <em>collectAsState</em>: Damit wird eine Flow Liste mit Geräten emittiert, und somit werden Änderungen im Datenmodel automatisch in die Oberfläche gesendet.</p>
</div>
<div class="sect2">
<h3 id="_jetpack_compose_ist_nicht_nur_ui">Jetpack Compose ist nicht nur UI</h3>
<div class="paragraph">
<p>Wichtig bei Jetpack Compose ist, dass das Framework selbst aus zwei Hauptteilen besteht: Jetpack Compose und Jetpack Compose UI.
Der Core hat keine Abhängigkeiten zu Android als Betriebsystem (obwohl die Klassen im Package-name <em>AndroidX</em> leben). Weder hat es eine Beziehung zur UI. Es ist nur zuständig für die Jetpack Compose Runtime und das Verwalten von der Baumdatenstrukturen, die für den State zuständig sind.
Daraus endstand auch die Idee, die Fähigkeiten von Jetpack Compose auf weitere Platrofmen zu übertragen, wodurch Jetpack Compose Desktop und Jetpack Compose Web entstanden sind.
Es existiert auch eine Variante für das Terminal mit dem Namen Mosaic, und es gibt auch erste Anzeichen, dass auch eine Portierung für iOS kommen könnte.
Jetpack Compose kommt zwar von Google und ist primär zum Bauen von Bedienoberflächen auf Android ausgelegt, aber durch die konsequente Trennung zwischen Core und UI ermöglich es die Umsetzung einer weiteren, pfiffigen Idee.
Wenn wir uns erinnern, was der Core Teil des Jetpack Compose macht, also das Verwalten vom State einer Baumdatenstruktur, und wenn wir uns überlegen, wie man den Zustand eines physikalischen Gerätes am besten abbilden kann, kommt man wieder zu Baumdatenstrukturen. So ist die Bibliothek Molecule &lt;LINK 7&gt; entstanden, die Kotlin Multiplatform-fähig ist. Ein Beispiel, wie ein Composable Presenter aussehen könnte, ist in Listing &lt;CODE 1&gt; dargestellt.
Diese Composable Funktionen können in der Domainschicht unserer Architektur liegen, weil sie keine Abhängigkeiten an UI oder Betriebssystem haben.</p>
</div>
<div class="listingblock">
<div class="title">CODE 1 Composable</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">sealed interface DeviceModel {
    object Loading : DeviceModel
    data class Data(val name: String) : DeviceModel
}

@Composable
fun DevicePresenter(
    deviceFlow: Flow&lt;Device&gt;
): DeviceModel {
    val device by deviceFlow.collectAsState(null)
    return if (device == null) {
        Loading
    } else {
        Data(user.name, balance)
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui">UI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wie es aus dem Architekturbild ersichtlich ist, Block zuständig für die Bedienoberfläche benannt CommonUI, nutzt gemeinsames Code geschrieben in Kotlin am alle Platformen, die Jetpack Compose in einer von den unterstützten Variante unterstützt. Wir haben als erstes die IoT Explorer App für Desktop als JVM gebaut und mit einer Variante für MacOS X experimentiert.</p>
</div>
<div class="sect2">
<h3 id="_viewmodel">ViewModel</h3>
<div class="paragraph">
<p>ViewModels haben sich als eine perfekte Begleitung für reaktive Bedienoberflächen erwiesen. Das gilt nicht nur für Jetpack Compose, sondern genau so für SwiftUI. Als Implementierung haben wir zum Kotlin Multiplatform Konzept von expect/actual gegriffen, siehe &lt;CODE 2&gt; und &lt;CODE 3&gt;. So ist es zum Beispiel möglich für Android eine native Variante zu nutzen, die Application Lifecycle berücksichtigt.</p>
</div>
<div class="paragraph">
<p>CODE 2 ViewModel</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">expect open class CommonViewModel() {
    val clientScope: CoroutineScope
    protected open fun onCleared()
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">ViewModel on Android</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import kotlinx.coroutines.CoroutineScope

actual open class CommonViewModel actual constructor() : ViewModel() {
    actual val clientScope: CoroutineScope = viewModelScope
    actual override fun onCleared() {
        super.onCleared()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Es hat sich als eine gute Idee erwiesen, die ViewModels so definieren, dass der Konstruktor sehr wenig oder keine Parameter hat, um eine Möglichkeit zu haben, die ViewModel Objekte auch in den Composable Funktionen zu instanziieren. Dabei hat sich <em>dependency injection</em> als ein gangbarer Weg ergeben, um notwendige Objekte in ViewModels zu referenzieren. Hier können wir den Vorteil nutzen, dass Kotlin und Kotlin Multiplatform auch von einer wunderbaren Community leben und somit könnten wir <em>Koin</em>&lt;LINK 8&gt;, als ein Kotlin Multiplatform fähiges Framework einsetzen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unidirectional_data_flow">Unidirectional Data Flow</h3>
<div class="paragraph">
<p>Reaktive Oberflächen leben davon, dass die Daten in der UI nur in einer Richtung laufen, sich die Anzeige anhand der Deklaration durch Recomposition wieder anpasst und die neue UI gerendert wird. Wie können wir aber die Daten verändern oder wie gehen wir mit Benutzereingaben oder UI Ereignissen um? Wenn wir bei der IoT Explorer App bleiben: Um den Zustand eines Gerätes, zum Beispiel einen Schalter aktivieren oder um die Rollladen im Smarthome runterzufahren, muss entsprechendes Kommando über ein Protokoll, welches das Gerät versteht, geschickt werden. Das ist deutlich mehr, als eine Bedienoberfläche wissen sollte. In diesem Fall nutzen wir wieder ein weiters Konzept aus der Clean Architecture, den UseCase. Die Implementierung davon lebt wieder in der Domain Schicht, hat kein Wissen über der Bedienoberfläche und muss nur das Object kennen, das mit dem Gerät kommuniziert. Im &lt;BILD 4&gt; ist die Kommunikation grafisch dargestellt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/unidirectional_dia.png" alt="unidirectional dia">
</div>
<div class="title">Figure 4. &lt;BILD 4&gt; Data flow</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ios">iOS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_technische_integration">Technische integration</h3>

</div>
<div class="sect2">
<h3 id="_kotlin_on_ios">Kotlin on iOS</h3>
<div class="paragraph">
<p>Kotlin Multiplattform hat einen anderen Ansatz als beispielsweise
ReactNative oder Flutter: Während sich mit diesen Frameworks vor allem
User Interfaces für verschiedene Platformen bauen lassen, überlässt KMP
genau das dem nativen Code. Das ermöglicht nicht nur, auf jeder
Plattform alle Möglichkeiten zu nutzen, es erlaubt auch, insbesondere auf
Apple Platform, die freie Wahl des Frameworks: KMP arbeitet genau so gut
mit UIKit zusammen wie mit SwiftUI. Technisch stellt sich auf iOS Seite
der Kotlin Multiplattform Teil als Cocoapods Dependency dar, und der
Kotlin Code wird direkt aus Xcode gebaut — es ist nicht notwendig, erst
mit einer anderen Toolchain eine Library ohne ähnliches zu bauen. Das
ermöglicht es auch den iOS Entwickler:innen, schnell und einfach
Änderungen am Kotlin Code vorzunehmen, und selbst zu testen, und
möglicherweise ins Repository zurückzuschreiben. Technisch wird KMP als
eine CocoaPods Dependency in ein Xcode Projekt eingefügt. Beim Anlegen
eines KMP Projekts im Android Studio wird auch ein Xcode Workspace
erzeugt, im Prinzip kann aber auch ein bestehender oder anderer
Workspace den Kotlin Code integrieren. Das bedeutet auch, dass die Xcode
Dateien völlig unabhängig von der Android Version sind, und somit
beliebig umbenannt oder verändert werden können. Die vom Kotlin Code
bereitgestellten Interfaces lassen sich aus Swift direkt aufrufen, und
auch problemlos in SwiftUI Integrieren. Es können also zum Beispiel im
Shared Kotlin Code direkt ViewModels erzeugt werden, um dann
entsprechend angezeigt zu werden. Kotlin Multiplattform Code muss aber
nicht immer gleich sein: Selbst in der geteilten Bibliothek kann es einen
unterschiedlichen Code für Android und iOS geben, der dann trotzdem mit
einem einheitlichen API an die jeweiligen Plattformen weitergegeben
wird. Das ist insbesondere deshalb interessant da hier im iOS Teil auch
auf Apple Frameworks zugegriffen werden kann. Beispielsweise wäre es
möglich, mit Kotlin für iOS schon mit den System Frameworks von iOS
lokalisierte Zeit und Datumsangaben zu übergeben, während das auf
Android mit den entsprechenden Frameworks funktioniert. Aber hier hören
die Möglichkeiten nicht auf: Es lassen sich sogar für den Kotlin Code
native Bibliotheken für iOS mit CocoaPods einbinden, und dann mit Kotlin
aufrufen. Dies erlaubt es, auch bei klarer Trennung der Aufgaben
plattformspezifisch im gemeinsamen Code zu arbeiten. Wer sich die
Integration etwas genauer ansieht, stellt fest, dass Kotlin in der Apple
Welt noch über eine Objective-C Brücke integriert wird. Während es damit
zwar auch möglich wäre, Kotlin aus einer Objective-C App aufzurufen, ist
der Hauptgrund vermutlich, dass das Swift Application Binary Interface
(ABI), dass also die Schnittstelle zu Swift definiert, vor noch nicht
allzu langer Zeit nicht stabil war, sondern sich noch regelmäßig
geändert hat. Ob es in der Zukunft ein wirklich natives Interface zu
Swift geben wird, ist noch unklar. Das erzeugt an manchen Stellen etwas
Reibung: Kotlin Coroutines werden auf iOS als Funktionen mit einer
Closure umgesetzt, da Objective-C dieses Konzept von asynchronen
Funktionen nicht kennt. Wer möchte, kann diese Funktionen natürlich in
Swift in Combine Publisher, oder auch als Async/Await Funktionen
verpacken. Damit aber auch Cancellations aus dem Kotlin Code an Swift
übergeben werden können, ist ein Plugin nötig, das die entsprechende
Funktionalität von Kotlin über Objective-C in Swift transportiert.
Kotlin Multiplattform ist extrem flexibel, und wirkt auf jeder Platform
heimisch. Durch eine sehr aktive Community und die Unterstützung von
JetBrains ist zu erwarten, dass dies in den kommenden Jahren noch besser
wird.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integration_ins_development_teams">Integration ins development teams</h3>
<div class="paragraph">
<p>Kotlin Multiplattform hat aber nicht nur technische Eigenschaften,
sondern auch etwas, was „Soft Skills“ gleichkommt. Ein zentrales Problem
bei vielen Cross-Platform Projekten ist weniger die verwendete
Technology, als das Staffing —also die Auswahl der Entwickler:innen.
Nicht selten wird ein Projekt ausschliesslich mit zum Beispiel
JavaScript oder Dart Expert:innen besetzt, in der Hoffnung, dass diese
die gesamte Entwicklung bis hin zum Deployment übernehmen können. Das
mag bei einfachen Anwendungen funktionieren; viele Projekte stellen sehr
schnell fest, dass es ohne genaue Kenntnisse der Plattform nicht
funktioniert. Alle Cross Platform Tools sind auf Plugins zur nativen
Plattform angewiesen, wenn sie etwas spannendere Dinge tun möchten — zum
Beispiel per Bluetooth kommunizieren oder Passwörter sicher abspeichern.
Wenn es dann ein Problem mit diesen Plugins gibt, egal ob durch die
Verwendung, neue SDKs oder neue Toolchains, ist genaues Wissen über das
Zielsystem und die verwendeten Programmiersprachen unerlässlich.
Insgesamt können OS Updates, neue SDKs und Werkzeuge immer für
Überraschungen sorgen. Und auch beim Deployment in AppCenter,
TestFlight, Google Play oder den AppStore kann es Feinheiten geben, für
die es ein spezialisiertes Wissen braucht. Wie löst Kotlin Multiplattform
dieses Problem? Nicht durch Technik, jedenfalls nicht durch neue
Technik: KMP setzt konsequent auf Tools, die Android und iOS
Entwickler:innen absolut geläufig sind: Die IDEs Android Studio, Xcode
sind ihre täglichen Werkzeuge, und der Paketmanager CocoaPods ist bei
der iOS Entwicklung ausserordentlich populär. Das bedeutet, dass Teams
wirklich nur die Dinge neu lernen müssen, die absolut notwendig sind.
Sie können sich sonst in den Umgebungen bewegen, die ihnen vertraut
sind, und mit denen sie sich auskennen. Kotlin und Swift sind sich als
Sprachen sehr ähnlich in Syntax und Konzepten, wer die eine kann, kann
die andere zumindest lesen und auch leicht erlernen. Und weil bei KMP
nicht nur einfach Binärdateien über den Zaun geworfen werden, kann
gemeinsam genutzter Code auch von allen angesehen, debugged und geändert
werden. Abschliessend bleibt zu sagen, dass sogar der Kotlin Compiler
Konan einfach nur ein Frontend für llvm ist, der „Low Level Virtual
Machine“ die auch schon das Backend für Swift und Apples C-Compiler
Clang ist. Das macht auf iOS vieles einfacher, auch weil damit der
Standard Debugger lldb automatisch mit diesen Binaries umgehen kann. So
ermöglicht es KMP, Projekte direkt mit Profis für die Plattformen zu
besetzen, die gleichzeitig auch zusammen an Cross Platform Code arbeiten
können.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zusammenfassung">Zusammenfassung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mit Kotlin und Kotlin Multiplatform haben wir ein Konzeptapp entwickelt&lt;LINK 9&gt;, welche die Vorteile der Sprache als moderne und gut lesebare Programmiersprache dokumentieren soll. Es ist immer wieder erfreulich festzustellen, wie mächtig Kotlin und die Standard-Bibliothek von Kotlin sind, sodass man mit hauseigenen Mitteln wie coroutines und Flow früher sehr aufwendig zu implementierende Konzepte wie asynchrone Programmierung elegant umsetzen kann. Jetpack Compose sogar weiter und mit der Unterstützung von Kotlin ist es möglich, reaktive Bedienoberflächen deklarativ zu entwickeln. Die Idee, das man kann auch an nicht visuelle Elemente der App die Composable Funktionen mit ihrer Fähigkeit, einen Status zu halten, zu verwenden und auf Veränderung mit recomposition zu reagieren, zeigt auch die Stärke von Jetpack Compose. Ein Zusammenspiel mit einer durchdachten Architektur macht das Entwicklen einer moderner HMI App möglich.
Neben der Technik haben wir auch festgestellt wie wichtig die SoftSkills sind und wie sich Kotlin in multiplatform Teams anfühlt und etablieren kann.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_links">Links</h2>
<div class="sectionbody">
<div class="paragraph">
<p>1.Jetpack Compose Projekt <a href="https://developer.android.com/jetpack/compose" class="bare">https://developer.android.com/jetpack/compose</a>
2. Jetpack Bibliotheken <a href="https://developer.android.com/jetpack" class="bare">https://developer.android.com/jetpack</a>
3. <a href="https://talkingkotlin.com/%D1%81ompose-in-%D1%81ashApp-with-jake-wharton-and-saket-narayan/" class="bare">https://talkingkotlin.com/%D1%81ompose-in-%D1%81ashApp-with-jake-wharton-and-saket-narayan/</a>
4. <a href="https://kotlinlang.org/#why-kotlin" class="bare">https://kotlinlang.org/#why-kotlin</a>
5. <a href="https://plc4x.apache.org/" class="bare">https://plc4x.apache.org/</a>
6. <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" class="bare">https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html</a>
7. <a href="https://github.com/cashapp/molecule" class="bare">https://github.com/cashapp/molecule</a>
8. <a href="https://insert-koin.io/" class="bare">https://insert-koin.io/</a>
9. <a href="https://github.com/michalharakal/iot-explorer" class="bare">https://github.com/michalharakal/iot-explorer</a></p>
</div>
<div class="paragraph">
<p>Java Logo
Mark Anderson (work for hire for Sun Microsystems) - <a href="http://www.logoeps.com/java-eps-vector-logo/40925/" class="bare">http://www.logoeps.com/java-eps-vector-logo/40925/</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-10-03 22:13:24 +0200
</div>
</div>
</body>
</html>